<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        
        <title>{% block title %}Group Bank{% endblock %}</title>

        {% block stylesheets %}

            <!--BOOTSTRAP CSS-->
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
            <!--WEBFONTS-->
            <link rel="preconnect" href="https://fonts.gstatic.com">
            <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&family=Poiret+One&display=swap" rel="stylesheet">
            <!--SPECIAL STYLING-->
            <link rel="stylesheet" href="{{ asset('css/style.css') }}"> <!-- page CSS personnalisÃ©e -->
        {% endblock %}

        {% block javascripts %}

            <!--FONTAWESOME-->
            <script src="https://kit.fontawesome.com/1219d1b540.js" crossorigin="anonymous"></script>
        {% endblock %}
    </head>
    <body>
        {% include "header.html.twig" %}
        {% include "nav.html.twig" %}
        <main id="main" class="container my-5">
            <main id="main" class="container my-5">
                <style>
                    #main {
                        background-color: white;
                    }
                </style>
                {% block body %}{% endblock %}
            </main>
                    </main>
                    <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }

    .chat-circle {
      width: 60px;
      height: 60px;
      background-color: #0084ff;
      border-radius: 50%;
      position: fixed;
      bottom: 20px;
      right: 20px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 999;
      animation: snakeMove 20s linear infinite; /* Updated animation duration */
    }

    @keyframes snakeMove {
      0% {
        background-color: #0084ff;
      }
      16.67% {
        background-color: #84ff00;
      }
      33.33% {
        background-color: #ff0084;
      }
      50% {
        background-color: #84ff00;
      }
      66.67% {
        background-color: #0084ff;
      }
      83.33% {
        background-color: #84ff00;
      }
      100% {
        background-color: #0084ff;
      }
    }

    .chat-window {
      width: 300px;
      height: 400px;
      background-color: #fff;
      border-radius: 10px;
      position: fixed;
      bottom: 100px;
      right: 30px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: none;
      z-index: 998;
    }

    .chat-header {
      background-color: #0084ff;
      color: #fff;
      padding: 10px;
      border-radius: 10px 10px 0 0;
    }

    .chat-body {
      padding: 10px;
      overflow-y: auto;
      max-height: calc(100% - 60px);
    }

    .chat-message {
      margin-bottom: 10px;
      padding: 8px 12px;
      border-radius: 8px;
      max-width: 70%;
      display: inline-block;
      clear: both;
    }

    .user-message {
      text-align: right;
      background-color: #0084ff;
      color: #fff;
      float: right;
      animation: fadeInRight 0.5s;
    }

    .bot-message {
      text-align: left;
      background-color: #f0f0f0;
      color: #000;
      float: left;
      animation: fadeInLeft 0.5s;
    }

    .chat-input {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
      background-color: #fff;
      display: flex;
      align-items: center;
    }

    .chat-input input[type="text"] {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 20px;
      margin-right: 10px;
      font-size: 16px;
      outline: none;
    }

    .chat-input button {
      width: 80px;
      height: 36px;
      border: none;
      border-radius: 20px;
      background-color: #0084ff;
      color: white;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }

    .chat-input button:hover {
      background-color: #0073e6;
    }

    .logo-icon {
      width: 100%;
      height: auto;
    }

    @keyframes fadeInRight {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes fadeInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
  </style>
</head>
<body>
<div class="chat-circle" onclick="toggleChatWindow()">
    <span class="text">
      <img class="logo-icon" src="/images/logo.png" alt="icon">
    </span>
</div>

<div class="chat-window" id="chat-window">
  <div class="chat-header">Chat</div>
  <div class="chat-body" id="chat-body">
    <!-- Chat messages will be appended here -->
  </div>
  <div class="chat-input">
    <input type="text" id="user-input" placeholder="Type your message...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  let isOpen = false;

  function toggleChatWindow() {
    const chatWindow = document.getElementById('chat-window');
    isOpen = !isOpen;
    chatWindow.style.display = isOpen ? 'block' : 'none';
    if (isOpen) {
      sendMessage();
    }
  }

  function sendMessage() {
    const messageInput = document.getElementById('user-input');
    const message = messageInput.value.trim();
    if (message === '') return;

    const options = {
      method: 'POST',
      url: 'https://api.edenai.run/v2/aiproducts/askyoda/v2/241a829e-3ab5-4746-bfe6-39ae3ed3d13d/ask_llm',
      headers: {
        authorization: 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiOTJkNjE1M2YtN2MzMy00YWYxLWJmZmItNjJkMWM2MTA4YWUzIiwidHlwZSI6ImZyb250X2FwaV90b2tlbiJ9.47CRpfGJK6E_QIJ5w6O8R6Z0LNVSNkgaLhvJYoG1SUE',
      },
      data: {
        query: message,
        llm_provider: 'openai',
        llm_model: 'gpt-4',
        k: 5,
        filter_documents: { metadata1: 'value1' },
        max_tokens: 100,
        temperature: 0,
      },
    };

    axios.request(options)
      .then((response) => {
        const chatBody = document.getElementById('chat-body');
        const userMessage = document.createElement('div');
        userMessage.classList.add('chat-message', 'user-message');
        userMessage.textContent = message;
        chatBody.appendChild(userMessage);

        const botMessage = document.createElement('div');
        botMessage.classList.add('chat-message', 'bot-message');
        botMessage.textContent = response.data.result;
        chatBody.appendChild(botMessage);

        messageInput.value = ''; // Clear input field after sending message
        chatBody.scrollTop = chatBody.scrollHeight; // Scroll to bottom of chat window
      })
      .catch((error) => {
        console.error(error);
      });
  }
</script>
        {% include "footer.html.twig" %}
        <!--BOOSTRAP SCRIPTS-->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>
    </body>
</html>
